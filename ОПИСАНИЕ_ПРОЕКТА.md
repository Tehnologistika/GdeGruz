# GdeGruz Bot - Telegram –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**GdeGruz** - —ç—Ç–æ Telegram –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–π—Å–∞–º–∏. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–∞–∑–µ Aiogram 3.0.0 –∏ FastAPI, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

1. **–î–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤)
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Ä–µ–π—Å–æ–≤
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–π—Å–∞ (–ø–æ–≥—Ä—É–∑–∫–∞ ‚Üí –≤ –ø—É—Ç–∏ ‚Üí –≤—ã–≥—Ä—É–∑–∫–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ñ–æ—Ç–æ –ø–æ–≥—Ä—É–∑–∫–∏, –¢–¢–ù, –£–ü–î, —Ñ–æ—Ç–æ –≤—ã–≥—Ä—É–∑–∫–∏)

2. **–î–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤:**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ä–µ–π—Å–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
   - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤
   - –ó–∞–ø—Ä–æ—Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —É –≤–æ–¥–∏—Ç–µ–ª–µ–π
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:**
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è–º –æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ REMIND_HOURS)
   - –≠—Å–∫–∞–ª–∞—Ü–∏—è –≤ –≥—Ä—É–ø–ø—É, –µ—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ —Å–≤—è–∑—å 14+ —á–∞—Å–æ–≤
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Python**: 3.11
- **Aiogram**: 3.0.0 (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram bot framework)
- **FastAPI**: latest (–≤–µ–±-API –¥–ª—è –∫–∞—Ä—Ç—ã —Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è–º–∏)
- **aiosqlite**: –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å SQLite
- **SQLite**: 3.x (3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ë–î)

### Deployment
- **Docker** + **docker-compose** (—Å –¥–µ—Ñ–∏—Å–æ–º!)
- **GitHub Actions** –¥–ª—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è –Ω–∞ push –≤ main
- **Timeweb** —Å–µ—Ä–≤–µ—Ä (SSH –¥–æ—Å—Ç—É–ø)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
GdeGruz/
‚îú‚îÄ‚îÄ bot/                           # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ü–∏–∫–ª –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py               # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–∫—É—Ä–∞—Ç–æ—Ä/–≤–æ–¥–∏—Ç–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ utils.py                   # is_curator() - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ handlers/                  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ start.py               # /start - –≤—ã–¥–∞—á–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îÇ       ‚îú‚îÄ‚îÄ contact.py             # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É
‚îÇ       ‚îú‚îÄ‚îÄ location.py            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ curator.py             # –ü–∞–Ω–µ–ª—å –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–æ–≤)
‚îÇ       ‚îú‚îÄ‚îÄ driver_trips.py        # –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Å–æ–≤ –≤–æ–¥–∏—Ç–µ–ª–µ–º
‚îÇ       ‚îú‚îÄ‚îÄ documents.py           # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ stop.py                # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ resume.py              # –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ redeploy.py            # (–æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
‚îÇ
‚îú‚îÄ‚îÄ web/                           # FastAPI –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ api.py                     # HTTP API –¥–ª—è –∫–∞—Ä—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ templates/                 # HTML —à–∞–±–ª–æ–Ω—ã (Jinja2)
‚îÇ
‚îú‚îÄ‚îÄ db.py                          # –†–∞–±–æ—Ç–∞ —Å points.db (–≤–æ–¥–∏—Ç–µ–ª–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
‚îú‚îÄ‚îÄ db_trips.py                    # –†–∞–±–æ—Ç–∞ —Å trips.db (—Ä–µ–π—Å—ã, —Å–æ–±—ã—Ç–∏—è)
‚îú‚îÄ‚îÄ db_documents.py                # –†–∞–±–æ—Ç–∞ —Å documents.db (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)
‚îÇ
‚îú‚îÄ‚îÄ cleanup_test_data.py           # –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
‚îú‚îÄ‚îÄ urgent_cleanup.py              # –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ Dockerfile                     # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (multi-stage)
‚îú‚îÄ‚îÄ requirements.txt               # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ deploy.sh                      # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ CI)
‚îÇ
‚îú‚îÄ‚îÄ .env                           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ù–ï –≤ git)
‚îú‚îÄ‚îÄ .env.example                   # –ü—Ä–∏–º–µ—Ä .env
‚îÇ
‚îî‚îÄ‚îÄ .github/workflows/
    ‚îî‚îÄ‚îÄ deploy.yml                 # GitHub Actions –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π

```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (3 SQLite —Ñ–∞–π–ª–∞)

### 1. points.db - –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª–µ–π

**–ü—É—Ç—å –≤ Docker**: `/app/data/points.db`

**–¢–∞–±–ª–∏—Ü—ã**:

```sql
-- –í–æ–¥–∏—Ç–µ–ª–∏
CREATE TABLE drivers (
    user_id INTEGER PRIMARY KEY,    -- Telegram user ID
    phone   TEXT,                    -- +79991234567
    active  INTEGER DEFAULT 1        -- 1 = –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
);

-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
CREATE TABLE points (
    id      INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    lat     REAL NOT NULL,           -- –®–∏—Ä–æ—Ç–∞
    lon     REAL NOT NULL,           -- –î–æ–ª–≥–æ—Ç–∞
    ts      TEXT NOT NULL            -- ISO timestamp
);
```

**–†–∞–±–æ—Ç–∞ —Å –ë–î**: –º–æ–¥—É–ª—å `db.py`

### 2. trips.db - –†–µ–π—Å—ã

**–ü—É—Ç—å –≤ Docker**: `/app/data/trips.db`

**–¢–∞–±–ª–∏—Ü—ã**:

```sql
-- –†–µ–π—Å—ã
CREATE TABLE trips (
    trip_id               INTEGER PRIMARY KEY AUTOINCREMENT,
    trip_number           TEXT UNIQUE NOT NULL,     -- –¢–õ-0001, –¢–õ-0002
    user_id               INTEGER,                  -- Telegram ID –≤–æ–¥–∏—Ç–µ–ª—è
    phone                 TEXT NOT NULL,            -- +79991234567
    loading_address       TEXT NOT NULL,
    loading_date          TEXT NOT NULL,            -- –î–î.–ú–ú.–ì–ì–ì–ì
    unloading_address     TEXT NOT NULL,
    unloading_date        TEXT NOT NULL,
    rate                  REAL NOT NULL,            -- –°—Ç–∞–≤–∫–∞ –≤ —Ä—É–±–ª—è—Ö
    status                TEXT DEFAULT 'assigned',  -- –°–º. –Ω–∏–∂–µ
    created_at            TEXT NOT NULL,
    loading_confirmed_at  TEXT,
    unloading_confirmed_at TEXT,
    completed_at          TEXT,
    curator_id            INTEGER,
    sdek_tracking         TEXT
);

-- –°–æ–±—ã—Ç–∏—è —Ä–µ–π—Å–æ–≤ (–ª–æ–≥)
CREATE TABLE trip_events (
    id          INTEGER PRIMARY KEY AUTOINCREMENT,
    trip_id     INTEGER NOT NULL,
    event_type  TEXT NOT NULL,
    description TEXT,
    created_at  TEXT NOT NULL,
    created_by  INTEGER,
    metadata    TEXT,
    FOREIGN KEY (trip_id) REFERENCES trips(trip_id)
);
```

**–°—Ç–∞—Ç—É—Å—ã —Ä–µ–π—Å–æ–≤**:
- `assigned` - –ù–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—é, –æ–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- `active` - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –ø–æ–≥—Ä—É–∑–∫–µ
- `in_transit` - –í –ø—É—Ç–∏ (–ø–æ–≥—Ä—É–∑–∏–ª—Å—è)
- `delivered` - –î–æ—Å—Ç–∞–≤–ª–µ–Ω (–≤—ã–≥—Ä—É–∑–∏–ª—Å—è)
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω (–¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã)
- `cancelled` - –û—Ç–º–µ–Ω–µ–Ω

**–†–∞–±–æ—Ç–∞ —Å –ë–î**: –º–æ–¥—É–ª—å `db_trips.py`

### 3. documents.db - –î–æ–∫—É–º–µ–Ω—Ç—ã

**–ü—É—Ç—å –≤ Docker**: `/app/data/documents.db`

**–¢–∞–±–ª–∏—Ü—ã**:

```sql
CREATE TABLE documents (
    id            INTEGER PRIMARY KEY AUTOINCREMENT,
    trip_id       INTEGER NOT NULL,
    user_id       INTEGER NOT NULL,
    document_type TEXT NOT NULL,     -- –°–º. –Ω–∏–∂–µ
    file_id       TEXT NOT NULL,     -- Telegram file_id
    uploaded_at   TEXT NOT NULL,
    FOREIGN KEY (trip_id) REFERENCES trips(trip_id)
);
```

**–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**:
- `loading_photo` - –§–æ—Ç–æ –ø–æ–≥—Ä—É–∑–∫–∏
- `acceptance_act` - –ê–∫—Ç –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏
- `unloading_photo` - –§–æ—Ç–æ –≤—ã–≥—Ä—É–∑–∫–∏
- `invoice` - –¢–æ–≤–∞—Ä–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è (–¢–¢–ù, –£–ü–î)

**–†–∞–±–æ—Ç–∞ —Å –ë–î**: –º–æ–¥—É–ª—å `db_documents.py`

---

## –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–ª–∏—á–∞–µ—Ç **2 —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –∫—É—Ä–∞—Ç–æ—Ä—ã –∏ –≤–æ–¥–∏—Ç–µ–ª–∏.

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏

**–§—É–Ω–∫—Ü–∏—è**: `bot/utils.py::is_curator(user_id)`

```python
def is_curator(user_id: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ CURATOR_IDS –∏–∑ .env"""
    curator_ids_str = os.getenv("CURATOR_IDS", "")
    curator_ids = [int(x.strip()) for x in curator_ids_str.split(",") if x.strip()]
    return user_id in curator_ids
```

**–ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π user_id**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É `/myid`

### –ö—É—Ä–∞—Ç–æ—Ä (Dispatcher)

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞** (`curator_kb()` –∏–∑ keyboards.py):
```
[üéõ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è] [‚ûï –°–æ–∑–¥–∞—Ç—å —Ä–µ–π—Å]
[üìã –°–ø–∏—Å–æ–∫ —Ä–µ–π—Å–æ–≤]     [üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]
```

**–ö–æ–º–∞–Ω–¥—ã**:
- `/start` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `/admin` - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `/create_trip` - –°–æ–∑–¥–∞—Ç—å —Ä–µ–π—Å
- `/trips` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–π—Å–æ–≤
- `/myid` - –£–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–æ–≤ (—Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å–∞, –¥–∞—Ç—ã, —Å—Ç–∞–≤–∫–∞)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö/–∞–∫—Ç–∏–≤–Ω—ã—Ö/–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ä–µ–π—Å–æ–≤
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–π—Å–æ–≤ –≤—Ä—É—á–Ω—É—é
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤
- –û—Ç–º–µ–Ω–∞ —Ä–µ–π—Å–æ–≤
- –ó–∞–ø—Ä–æ—Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —É –≤–æ–¥–∏—Ç–µ–ª—è
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π —Ä–µ–π—Å–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –í–æ–¥–∏—Ç–µ–ª—å (Driver)

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞** (`location_kb()` –∏–∑ keyboards.py):
```
[üìç –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º]
[üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã] [üìã –ú–æ–π —Ä–µ–π—Å]
[‚ùì –ü–æ–º–æ—â—å]
[üõë –ó–∞–∫–æ–Ω—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ]
```

**–ö–æ–º–∞–Ω–¥—ã**:
- `/start` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/my_trip` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ —Ä–µ–π—Å–∞
- `/help` - –ó–∞–ø—Ä–æ—Å –ø–æ–º–æ—â–∏ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫—É—Ä–∞—Ç–æ—Ä–∞–º)
- `/myid` - –£–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–π—Å–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–π—Å–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ñ–æ—Ç–æ, –¢–¢–ù, –£–ü–î)
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

**–§–∞–π–ª**: `.env` (—Å–æ–∑–¥–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`)

```bash
# Telegram Bot Token –æ—Ç @BotFather
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Telegram Admin User ID
ADMIN_ID=123456789

# Telegram Group Chat ID –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–π (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è –≥—Ä—É–ø–ø)
GROUP_CHAT_ID=-1001234567890

# Telegram Group –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
DOCUMENTS_GROUP_ID=-1001234567890

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ —á–∞—Å–∞—Ö (0.2 = 12 –º–∏–Ω—É—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤, 12.0 = 12 —á–∞—Å–æ–≤)
REMIND_HOURS=12.0

# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
TIMEZONE=Europe/Berlin

# API Secret Token (–¥–ª—è –≤–µ–±-API)
API_SECRET_TOKEN=your_secret_token_here

# Telegram ID –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –ë–ï–ó –ø—Ä–æ–±–µ–ª–æ–≤!)
# –£–∑–Ω–∞—Ç—å —Å–≤–æ–π ID: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É /myid
CURATOR_IDS=5799866832,6835069941
```

**–í–ê–ñ–ù–û**:
- `CURATOR_IDS` - ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –ë–ï–ó –ø—Ä–æ–±–µ–ª–æ–≤
- `GROUP_CHAT_ID` - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è –≥—Ä—É–ø–ø (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100`)
- `REMIND_HOURS` - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ —Å—Ç–∞–≤–∏—Ç—å 12.0 (12 —á–∞—Å–æ–≤)

---

## Docker & Deployment

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker

**docker-compose.yml**:

```yaml
version: '3.9'
services:
  bot:                          # Telegram –±–æ—Ç
    build: .
    env_file: .env
    environment:
      - STAGE=bot
    volumes:
      - ./data:/app/data        # –í–ê–ñ–ù–û: –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ë–î
    restart: always

  web:                          # FastAPI –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
    build: .
    env_file: .env
    environment:
      - STAGE=web
    volumes:
      - ./data:/app/data
    ports:
      - "8000:8000"
    restart: always
```

**Dockerfile** (multi-stage):

1. **Builder stage**: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π
2. **Runtime stage**: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **CMD**: –∑–∞–ø—É—Å–∫ bot –∏–ª–∏ web –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `STAGE`

### –ö–æ–º–∞–Ω–¥—ã Docker (–ù–ê –°–ï–†–í–ï–†–ï)

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker-compose` (—Å –¥–µ—Ñ–∏—Å–æ–º), –∞ –Ω–µ `docker compose`!

```bash
# === –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è ===

# –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –±–æ—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
docker-compose logs --tail=50 bot

# –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
docker-compose logs --tail=50 web

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)
docker-compose logs -f bot


# === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ ===

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
docker-compose stop bot

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose start bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose restart bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï —Å–µ—Ä–≤–∏—Å—ã
docker-compose stop

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –í–°–ï —Å–µ—Ä–≤–∏—Å—ã
docker-compose start


# === –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ===

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –í–°–ï —Å–µ—Ä–≤–∏—Å—ã –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d --build


# === –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ===

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î
docker-compose run --rm bot python urgent_cleanup.py
docker-compose run --rm bot python cleanup_test_data.py

# –û—Ç–∫—Ä—ã—Ç—å Python shell –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose run --rm bot python

# –í—ã–ø–æ–ª–Ω–∏—Ç—å bash –∫–æ–º–∞–Ω–¥—É
docker-compose exec bot ls -lah /app/data/

# –û—Ç–∫—Ä—ã—Ç—å bash shell (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω)
docker-compose exec bot bash


# === –û—á–∏—Å—Ç–∫–∞ ===

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -f

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker container prune -f
```

### –†–∞–±–æ—Ç–∞ —Å –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤
sqlite3 data/trips.db "SELECT COUNT(*) FROM trips;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–π—Å—ã
sqlite3 data/trips.db "SELECT trip_number, status, phone FROM trips ORDER BY created_at DESC LIMIT 10;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥–∏—Ç–µ–ª–µ–π
sqlite3 data/drivers.db "SELECT COUNT(*) FROM drivers;"

# –û—á–∏—Å—Ç–∏—Ç—å –ë–î —Ä–µ–π—Å–æ–≤ —á–µ—Ä–µ–∑ Docker
docker-compose run --rm bot python urgent_cleanup.py

# –ò–õ–ò –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL
sqlite3 data/trips.db "DELETE FROM trips;"
sqlite3 data/trips.db "DELETE FROM trip_events;"
sqlite3 data/trips.db "DELETE FROM sqlite_sequence WHERE name='trips';"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
sqlite3 data/trips.db ".schema trips"

# Backup –ë–î
cp data/trips.db data/trips_backup_$(date +%Y%m%d_%H%M%S).db
```

---

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–µ–ø–ª–æ—è

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd GdeGruz

# –°–æ–∑–¥–∞—Ç—å .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env (–¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã, ID)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker
docker-compose up -d

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f bot
```

### 2. –í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É (Claude Code –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
git checkout -b feature/new-feature

# –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
# ...

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
docker-compose restart bot
docker-compose logs --tail=50 bot

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "feat: –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ó–∞–ø—É—à–∏—Ç—å
git push origin feature/new-feature
```

### 3. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ GitHub (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)**

1. –°–æ–∑–¥–∞—Ç—å Pull Request –≤ –≤–µ—Ç–∫—É `main`
2. –°–º–µ—Ä–∂–∏—Ç—å PR
3. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh username@host

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç
cd /home/git/fleet-live-bot

# –ü–æ–¥—Ç—è–Ω—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose down
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs --tail=50 bot
```

### GitHub Actions (.github/workflows/deploy.yml)

**–¢—Ä–∏–≥–≥–µ—Ä**: Push –≤ –≤–µ—Ç–∫—É `main`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
1. SSH –Ω–∞ Timeweb —Å–µ—Ä–≤–µ—Ä
2. `cd /home/git/fleet-live-bot`
3. `git pull origin main`
4. `docker-compose down`
5. `docker-compose up -d --build`
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**–í–ê–ñ–ù–û**: –°–∫—Ä–∏–ø—Ç `deploy.sh` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GitHub Actions!

---

## –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É

1. –°–æ–∑–¥–∞—Ç—å handler –≤ `bot/handlers/`:

```python
# bot/handlers/my_command.py
from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message

router = Router()

@router.message(Command("mycommand"))
async def my_command(message: Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")
```

2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `bot/main.py`:

```python
from bot.handlers.my_command import router as my_command_router

# –í —Ñ—É–Ω–∫—Ü–∏–∏ main():
dp.include_router(my_command_router)
```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

```bash
docker-compose restart bot
```

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ –ë–î trips

1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –≤ `db_trips.py`:

```python
async def _ensure_schema(db: aiosqlite.Connection):
    # ...existing code...

    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ (–º–∏–≥—Ä–∞—Ü–∏—è)
    try:
        await db.execute("SELECT my_new_field FROM trips LIMIT 1")
    except:
        logger.info("Adding my_new_field column")
        await db.execute("ALTER TABLE trips ADD COLUMN my_new_field TEXT")
        await db.commit()
```

2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–π—Å–æ–≤

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
docker-compose restart bot
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `bot/keyboards.py`:

```python
def location_kb():
    kb = ReplyKeyboardBuilder()
    kb.button(text="üìç –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º", request_location=True)
    kb.button(text="üì§ –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞")  # <-- –¥–æ–±–∞–≤–∏–ª–∏
    kb.adjust(1, 1)  # <-- –∏–∑–º–µ–Ω–∏–ª–∏ layout
    return kb.as_markup(resize_keyboard=True)
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å `/start` —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫—É—Ä–∞—Ç–æ—Ä–∞

1. –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É `/myid`
2. –î–æ–±–∞–≤–∏—Ç—å ID –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh username@host
cd /home/git/fleet-live-bot

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env
nano .env
# CURATOR_IDS=5799866832,6835069941,NEW_ID_HERE

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose restart bot
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

```bash
# –í .env –∏–∑–º–µ–Ω–∏—Ç—å REMIND_HOURS:
REMIND_HOURS=12.0  # 12 —á–∞—Å–æ–≤ (–ø—Ä–æ–¥–∞–∫—à–Ω)
REMIND_HOURS=0.2   # 12 –º–∏–Ω—É—Ç (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart bot
```

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose ps

# 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs --tail=100 bot

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart bot

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
docker-compose exec bot env | grep BOT_TOKEN
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö—É—Ä–∞—Ç–æ—Ä –Ω–µ –≤–∏–¥–∏—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

```bash
# 1. –£–∑–Ω–∞—Ç—å user_id –∫—É—Ä–∞—Ç–æ—Ä–∞
# –ü–æ–ø—Ä–æ—Å–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É /myid

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CURATOR_IDS
cat .env | grep CURATOR_IDS

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
docker-compose logs bot | grep "Role check"

# 4. –î–æ–±–∞–≤–∏—Ç—å ID –≤ .env –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
nano .env
docker-compose restart bot
```

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ–π—Å—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -lah data/trips.db

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å permissions
ls -lah data/

# 3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–π—Å–∞
docker-compose logs bot | grep "Created trip"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î –Ω–∞–ø—Ä—è–º—É—é
sqlite3 data/trips.db "SELECT COUNT(*) FROM trips;"
sqlite3 data/trips.db ".schema trips"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs bot | grep "Saved point"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
sqlite3 data/points.db "SELECT COUNT(*) FROM points;"
sqlite3 data/points.db "SELECT user_id, ts FROM points ORDER BY ts DESC LIMIT 10;"
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

1. ‚úÖ **RCE —á–µ—Ä–µ–∑ /redeploy** - –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ (handlers/redeploy.py)
2. ‚úÖ **API Token –≤ frontend** - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ HttpOnly cookies (web/api.py)
3. ‚úÖ **Hardcoded CURATOR_IDS** - —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ .env (utils.py, handlers/curator.py)
4. ‚úÖ **Race condition –≤ —ç—Å–∫–∞–ª–∞—Ü–∏—è—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω asyncio.Lock (main.py)
5. ‚úÖ **–ö—É—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏** - –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (main.py:91-93)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚ùó –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` –≤ git
- ‚ùó –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è `API_SECRET_TOKEN`
- ‚ùó –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚ùó –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞—Ç—å backup –ë–î
- ‚ùó –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Aiogram 3.0 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.aiogram.dev/en/latest/
- **FastAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://fastapi.tiangolo.com/
- **SQLite –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://www.sqlite.org/docs.html
- **Docker Compose**: https://docs.docker.com/compose/

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **GitHub**: Tehnologistika/GdeGruz
- **Branch –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: `claude/review-*`
- **Main branch**: `main`
- **–°–µ—Ä–≤–µ—Ä**: Timeweb (SSH –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ GitHub Secrets)
- **–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**: `/home/git/fleet-live-bot`

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

- [ ] –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`
- [ ] –ü–æ–ª—É—á–∏—Ç—å BOT_TOKEN –æ—Ç @BotFather
- [ ] –£–∑–Ω–∞—Ç—å —Å–≤–æ–π user_id —á–µ—Ä–µ–∑ `/myid`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è –≤ CURATOR_IDS
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose up -d`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `docker-compose logs -f bot`
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É `/start`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–π—Å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å! üöÄ
